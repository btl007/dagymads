## Completed Sprints

### Sprint 2: 마이페이지 및 에디터 통합 (2025년 9월 4일 완료)

**목표:** 사용자 '마이페이지'를 구현하여 대본을 조회, 편집, 삭제하고, 에디터의 안정적인 로딩을 보장합니다.

**구현된 주요 기능:**

*   **마이페이지 오버레이 (`MyScript.jsx`):
    *   에디터 우측에 토글 가능한 오버레이 패널로 구현.
    *   사용자 대본 목록 조회 및 표시 (제목, 한 줄 미리보기, 최종 수정 시간).
    *   대본 삭제 기능 추가 (확인 알림 포함).
*   **에디터 (scriptEditor.jsx) 기능 개선:**
    *   **URL 기반 대본 로딩:** `/editor` (새 글) 또는 `/editor/스크립트ID` (기존 글 수정) 경로에 따라 대본을 정확히 로드.
    *   **저장되지 않은 변경사항 경고:** 에디터 내용 수정 후 저장하지 않고 앱 내부에서 다른 페이지로 이동 시 경고창 표시.
    *   **좌측 예시 대본 목록 기능 복원:** 클릭 시 에디터에 내용 삽입 기능 복구.
*   **핵심 버그 해결 및 아키텍처 개선:**
    *   **Supabase RLS `uuid` 오류 최종 해결:**
        *   **원인:** Supabase의 `auth.jwt() ->> 'sub'` 클레임이 `uuid` 타입으로 잘못 해석되는 내부적인 '마법' 같은 동작 때문이었음.
        *   **해결:** Clerk JWT 템플릿에 `user_id: "{{user.id}}"` 커스텀 클레임을 추가하고, RLS 정책을 `auth.jwt() ->> 'user_id'` 기반으로 수정하여 `TEXT` 타입 비교를 강제함.
    *   **에디터 로딩/렌더링 문제 해결:**
        *   **원인:** `useEffect` 내에서 `editorInstance`를 기다리면서 로딩 화면이 에디터 렌더링을 막는 '닭-달걀' 문제 발생.
        *   **해결:** `Editor.jsx`에 `onReady` 콜백을 복원하고, `scriptEditor.jsx`에서 `editorInstance.setEditorState()`를 사용하여 에디터 내용을 명령적으로 업데이트하는 방식으로 전환. 로딩 오버레이는 에디터 렌더링을 막지 않도록 수정.
    *   **Clerk `<SignedIn>` 충돌:** `react-router-dom`의 동적 파라미터와 `<SignedIn>` 컴포넌트 간의 충돌 확인. 임시적으로 `<SignedIn>` 래퍼를 제거하여 해결 (보안은 RLS에 위임).
    *   **`updated_at` 컬럼 누락:** 누락된 `updated_at` 컬럼 및 자동 업데이트 트리거 추가.

**결과:**

*   핵심 대본 관리 기능 (생성, 목록 조회, 편집, 삭제)이 이제 완벽하게 작동하고 안정적입니다.
*   사용자 경험을 개선하는 '저장되지 않은 변경사항' 경고 기능이 추가되었습니다.
*   복잡했던 에디터 초기화 및 데이터 연동 문제가 해결되어, 향후 기능 확장의 기반이 마련되었습니다.


### Sprint 3: 어드민 대쉬보드 및 대본 접수 기능 구현 (2025년 9월 6일 완료)

**목표:** 사용자가 작성한 대본을 '접수' 하면, 어드민 대쉬보드에서 대본의 내용을 확인할 수 있습니다.

**구현된 주요 기능:**

*   **어드민 대쉬보드:**
    *   **접근 제어:** `is_admin: "true"`인 사용자만 어드민 대쉬보드 접속 가능. (✅ 완료)
    *   **대본 조회 (컬럼 뷰):**
        *   `status != 'draft'`인 모든 대본을 조회 (사용자별 그룹화).
        *   사용자 ID 대신 Clerk에서 가져온 사용자 이름(username) 표시.
        *   대본 제목, 상태, 최종 수정일, 접수일로부터 경과 일수(D+NNN일) 표시.
        *   대본 내용 미리보기.
    *   **대본 상태 변경:** 'submitted', 'under_review', 'approved' 상태로 변경하는 버튼 구현.
*   **대본 접수 기능:**
    *   `scriptEditor.jsx`에 '접수' 버튼 추가.
    *   Supabase `scripts` 테이블에 `status` 및 `submitted_at` 컬럼 추가 및 업데이트.
    *   대본은 제출 후에도 수정 가능 (스냅샷 개념).
    *   '내 대본' 목록에 대본 상태 표시.
*   **어드민의 사용자 추가 기능:**
    *   `AddUserForm.jsx`를 통해 어드민이 새로운 사용자를 생성하는 기능 구현.
    *   Clerk API와 연동하여 사용자 계정 생성.
    *   보안에 취약한 비밀번호 사용 시, 명확한 에러 메시지를 표시하도록 UX 개선.

### Sprint 4: 프로젝트 관리 시스템 도입 및 UI/UX 개편 (2025년 9월 6일 완료)

**목표:** 단순 대본 관리 시스템에서, 영상 제작 프로세스 전반을 관리하는 SaaS의 기반을 마련하고 전체적인 사용자 경험을 개선합니다.

**구현된 주요 기능:**

*   **핵심 아키텍처 재설계:**
    *   **'프로젝트' 개념 도입:** 기존의 '대본' 중심에서, '센터'별 영상 제작 과정을 나타내는 '프로젝트' 중심으로 관리 단위를 변경.
    *   **데이터베이스 스키마 확장:**
        *   `projects` 테이블을 신규 생성하여 프로젝트의 상태, frame.io 링크 등을 관리.
        *   `scripts` 테이블에 `project_id`를 추가하여 프로젝트와 대본의 1:N 관계를 정립.
        *   `forSupabase.md` 가이드라인에 따라 `user_id`는 `TEXT`로, 테이블의 고유 ID는 `UUID`로 타입을 명확히 구분하여 설계.
    *   **백엔드 로직 자동화:**
        *   관리자가 신규 센터(사용자)를 생성하면, 해당 센터의 첫 번째 프로젝트가 `projects` 테이블에 자동으로 생성되도록 `create-clerk-user` Edge Function을 수정.
        *   프로젝트 생성 실패 시, 방금 만든 Clerk 유저를 다시 삭제하는 롤백 로직을 추가하여 데이터 정합성을 보장.

*   **어드민 대시보드 리팩토링:**
    *   **프로젝트 칸반 보드 도입:** 관리자가 전체 프로젝트의 진행 상황(`대본 필요`, `대본 접수`, `영상 초안` 등)을 한눈에 파악할 수 있는 칸반 보드를 구현.
    *   **기존 상세 뷰 유지:** 칸반 보드 하단에 기존의 3단 컬럼 뷰(센터 목록 -> 대본 목록 -> 대본 상세)를 유지하여, 상세 조회 및 아카이빙 목적으로 활용할 수 있도록 함.
    *   두 가지 뷰(칸반, 컬럼)에 필요한 데이터를 효율적으로 불러오고 관리하도록 데이터 로직을 통합.

*   **UI/UX 대규모 개선:**
    *   **스크립트 에디터 레이아웃 개편:** 좌측 '예시 대본'과 우측 '내 대본' 패널을 모두 동적으로 열고 닫을 수 있는 유연한 3단 레이아웃으로 전면 수정. `framer-motion`을 이용한 부드러운 애니메이션을 적용.
    *   **디자인 시스템 통일:** 앱 전반에 걸쳐 일관된 다크 모드 테마를 적용. `UserProfile`, `AdminDashboard`, `MyScript` 등 핵심 페이지들의 UI를 재정비하여 통일성을 확보.
    *   **컴포넌트 개선:** `MyScript` 목록을 정보 가독성이 높은 카드 형태로 변경하고, 대본 상태를 색상 뱃지로 표시하여 직관성을 높임.

*   **주요 버그 수정:**
    *   `user_profiles` 테이블의 `updated_at` 컬럼 누락 문제 해결.
    *   컴포넌트 리팩토링 과정에서 발생한 다수의 `ReferenceError` 및 중복 `export` 오류 수정.

### Sprint 5: 데이터 모델 및 관리자 UI 정교화 (2025년 9월 12일 완료)

**목표:** 사용자 경험을 개선하기 위해 데이터 흐름을 유기적으로 만들고, 관리자 대시보드의 사용성을 높이며, 치명적인 인증 및 데이터 로딩 버그를 해결합니다.

**구현된 주요 기능:**

*   **데이터 모델 정교화 (프로젝트-스크립트 연동):**
    *   **문제 인식:** `Project`와 `Script`가 `User`에만 각각 연결되어 있어, 스크립트 제출 시 어떤 프로젝트의 상태를 변경해야 할지 모호한 문제 발견.
    *   **해결:** `scripts` 테이블에 `project_id` 컬럼을 추가하여 `Project -> Script`의 명확한 부모-자식 관계를 정립.
    *   **사용자 경험(UX) 개선:** 사용자가 스크립트 저장 시, 시스템이 자동으로 해당 사용자의 가장 최근 프로젝트를 찾아 연결해주는 로직을 구현. 이를 통해 사용자는 프로젝트를 수동으로 선택할 필요가 없어짐.

*   **프로젝트 라이프사이클 자동화:**
    *   사용자가 '대본 접수' 버튼을 누르면, 해당 스크립트가 소속된 프로젝트의 상태가 `script_needed`에서 `script_submitted`로 자동 변경되는 로직을 구현.
    *   데이터베이스에 저장되는 상태(status) 값을 `대본 필요` (한글)에서 `script_needed` (영문)와 같이 표준화하여 데이터 일관성을 확보.

*   **관리자 대시보드 UI/UX 개선:**
    *   **칸반 카드 정보 개선:** 프로젝트 카드의 UI를 개편하여 센터명(username), 프로젝트명, 생성 연월, 경과일을 명확히 표시.
    *   **상세 조회 뷰 개편:** 기존 3단 구조를 **[전체 센터] - [센터 정보] - [접수된 대본] - [대본 내용]** 의 4단 구조로 확장하여 정보 탐색의 편의성을 증대.
    *   **칸반-상세조회 연동:** 칸반 카드에서 센터명을 클릭하면, 하단의 상세 조회 뷰가 해당 센터의 정보로 즉시 업데이트되는 동적 기능을 추가.

*   **치명적 버그 수정:**
    *   **JWT expired (토큰 만료) 오류:** `SupabaseProvider`가 앱 로딩 시 한 번만 토큰을 설정하던 문제를 해결. 이제 모든 API 요청마다 새로운 인증 토큰을 동적으로 받아 사용하도록 수정하여, 토큰 만료로 인한 인증 오류를 원천적으로 차단.
    *   **`get-all-clerk-users` 엣지 함수 오류:** CORS 정책, HTTP 메소드 불일치, Clerk SDK의 응답 데이터 구조 해석 오류 등 복합적인 문제를 단계적으로 디버깅하여 해결. 이제 관리자 UI에 필요한 모든 사용자의 `username`을 안정적으로 불러올 수 있음.

### Sprint 6: 관리자 대시보드 리팩토링 및 기능 확장 (2025년 9월 13일 완료)

**목표:** `shadcn/ui`를 도입하여 관리자 대시보드의 UI를 현대화하고, 중첩 라우팅을 적용하여 코드 구조를 개선하며, 새로운 관리 기능을 추가합니다.

**구현된 주요 기능:**

*   **`shadcn/ui` 도입 및 UI 시스템 구축:**
    *   `shadcn/ui` 라이브러리를 프로젝트에 설치하고, `jsconfig.json` 설정 및 의존성 문제를 해결하여 안정적인 개발 환경을 구축.
    *   `Table`, `Badge`, `ResizablePanel` 등 다양한 `shadcn` 컴포넌트를 활용하여 UI를 체계적으로 구성.
    *   `sidebar-01` 블록을 도입하여 전문적인 대시보드 사이드바 레이아웃을 빠르게 구현하고, 프로젝트에 맞게 커스터마이징.
    *   앱 전체에 다크 모드를 기본으로 적용하여 일관된 디자인을 유지.

*   **대시보드 아키텍처 리팩토링 (중첩 라우팅):**
    *   기존의 단일 거대 컴포넌트였던 `AdminDashboard`를 `AdminLayout`과 여러 페이지 컴포넌트로 분리.
    *   React Router의 `<Outlet />`을 사용한 중첩 라우팅 구조를 도입하여, 사이드바 레이아웃은 유지한 채 내부 컨텐츠만 교체하는 현대적인 SPA 아키텍처를 적용.
    *   `AdminOverview`, `AdminKanban`, `AdminScript`, `AdminUsers`, `AdminProject` 등 기능별로 페이지를 분리하여 코드의 모듈성과 확장성을 크게 향상.

*   **신규 관리 기능 추가:**
    *   **전체 프로젝트 조회 (`AdminProject.jsx`):** 모든 프로젝트의 상세 정보(프로젝트명, 센터명, 담당자명, 상태 등)를 한눈에 볼 수 있는 테이블 형태의 조회 기능을 구현.

*   **백엔드 스키마 확장:**
    *   `user_profiles` 테이블에 `address` (주소) 컬럼을 추가.
    *   `projects` 테이블에 `shootdate` (촬영일) 컬럼을 추가하여 향후 기능 확장을 위한 기반을 마련.

### Sprint 7: 촬영일 관리 캘린더 구현 및 리팩토링 (2025년 9월 14일 완료)

**목표:** 관리자가 프로젝트별 촬영 일정을 시각적으로 확인하고, 손쉽게 변경할 수 있는 캘린더 기능을 구현하며, 코드의 재사용성을 높입니다.

**구현된 주요 기능:**

*   **촬영일 관리 페이지 (`AdminVideo.jsx`):**
    *   프로젝트의 `shootdate`를 기반으로 날짜에 점을 찍어주는 캘린더를 구현.
    *   캘린더의 특정 날짜를 클릭하면, 해당일에 촬영이 예정된 프로젝트 목록이 우측에 표시됨.
    *   우측 목록의 프로젝트를 클릭하면, 촬영일을 변경할 수 있는 모달(`Dialog`)이 열림.
    *   모달 안의 캘린더에서 새로운 날짜를 선택하고 저장하면, 데이터베이스가 업데이트되고 UI가 자동으로 새로고침됨.
    *   날짜 변경 성공 시, "일정이 정상적으로 변경되었습니다." 라는 확인 알림(`Toast`)을 표시하여 사용자 경험을 개선.

*   **컴포넌트 리팩토링:**
    *   기존의 캘린더 로직을 분리하여, 특정 날짜 배열(`highlightedDates`)을 받아 점을 찍어주는 범용적인 `CustomCalendar.jsx` 컴포넌트를 생성.
    *   이를 통해 향후 다른 종류의 일정을 표시해야 할 때도 컴포넌트를 쉽게 재사용할 수 있는 기반을 마련.

*   **핵심 버그 해결:**
    *   **`useSupabase` 컨텍스트 오류:** `AdminVideo.jsx` 페이지에서만 Supabase 클라이언트 객체를 받아오지 못하는(`undefined`) 치명적인 문제를 발견.
    *   **원인:** `useSupabase()` 훅을 `const { supabase } = useSupabase()`로 잘못 사용하고 있었음. (올바른 사용법: `const supabase = useSupabase()`)
    *   **해결:** 올바른 훅 사용법으로 수정하여, 페이지의 모든 데이터 조회 기능(캘린더 점 표시, 날짜 클릭 시 상세 정보 표시)을 정상화함.